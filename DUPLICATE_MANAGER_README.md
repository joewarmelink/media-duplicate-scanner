# Duplicate Manager

An interactive tool to process duplicate media files found by the media duplicate scanner. Provides smart recommendations based on series distribution and file quality.

## Overview

The `duplicate_manager.py` application reads the JSON report generated by `media_duplicate_scanner.py` and provides an interactive interface to:

- **View series distribution** across different media roots
- **Get smart recommendations** for which files to keep
- **Safely delete** duplicate files with confirmation
- **Skip duplicates** for manual processing later

## Features

### üé¨ Movie Duplicates
- **Quality-based recommendations**: Prefers larger files (higher quality)
- **Simple interface**: Choose which file to keep, delete the rest
- **Safety confirmations**: Always confirm before deletion

### üì∫ TV Series Duplicates
- **Series overview**: Shows episode distribution across roots
- **Smart recommendations** based on:
  1. **Season-level preference**: Keep files from root with more episodes in the same season
  2. **Series-level preference**: If season counts are equal, prefer root with more total episodes
  3. **Quality preference**: Prefer larger files (higher quality)
- **Quality conflict alerts**: Warns when recommended file ‚â† highest quality file

## Usage

### Basic Usage
```bash
python duplicate_manager.py duplicate_report_20241208_143022.json
```

### Command Line Options
```bash
python duplicate_manager.py --help
```

## Workflow

### 1. Series Overview
The application first shows a distribution overview for each TV series:

```
üì∫ Breaking Bad
  üìÅ /media/4TB-WD2:
    Season 1: 7 episodes
    Season 2: 13 episodes
    Total: 20 episodes
  üìÅ /media/16TB-HM:
    Season 1: 7 episodes
    Season 2: 13 episodes
    Total: 20 episodes
```

### 2. Individual Episode Processing
For each duplicate episode, you'll see:

```
üì∫ Season 1 Episode 1
==================================================
  ‚≠ê RECOMMENDED
  1. /media/4TB-WD2/TV/Breaking Bad/Season 01/breaking.bad.s01e01.mkv
     Size: 2.0 GB
     Format: .mkv

  2. /media/16TB-HM/TV/Breaking Bad/Season 1/breaking.bad.s01e01.mp4
     Size: 1.0 GB
     Format: .mp4

üí° Recommendation: Root /media/4TB-WD2 has more episodes in Season 1 (7 vs 7)
```

### 3. User Choices
For each duplicate, you can:
- **Choose file to KEEP** (1, 2, etc.)
- **Skip** this duplicate ('s')
- **Quit** the application ('q')

### 4. Safety Features
- **File existence verification**: Skips duplicates where files no longer exist
- **Deletion confirmation**: Always asks for confirmation before deleting
- **Error handling**: Reports errors if deletion fails

## Recommendation Logic

### TV Series Priority Order:
1. **Season-level preference**: Keep file from root with more episodes in the same season
2. **Series-level preference**: If season counts are equal, prefer root with more total episodes
3. **Quality preference**: Prefer larger file (higher quality)

### Quality Conflict Detection:
When the recommended root ‚â† the file with highest quality, you'll see:
```
‚ö†Ô∏è  WARNING: Preferred file may be of lesser quality than the others
```

This allows you to make informed decisions about quality vs. organizational preference.

## Safety Features

- **File verification**: Checks that all files in duplicate groups still exist
- **Confirmation prompts**: Always asks before deleting files
- **Error reporting**: Shows detailed error messages if deletion fails
- **Graceful exit**: Can quit at any time with 'q'

## Example Output

```
üé¨ MEDIA DUPLICATE MANAGER
==================================================
Report: duplicate_report_20241208_143022.json
Scan completed: 2024-12-08T14:30:22
Total duplicates: 15

================================================================================
TV SERIES DISTRIBUTION OVERVIEW
================================================================================

üì∫ Breaking Bad
  üìÅ /media/4TB-WD2:
    Season 1: 7 episodes
    Season 2: 13 episodes
    Total: 20 episodes
  üìÅ /media/16TB-HM:
    Season 1: 7 episodes
    Season 2: 13 episodes
    Total: 20 episodes

================================================================================
PROCESSING TV DUPLICATES
================================================================================

üé¨ Processing: Breaking Bad
------------------------------------------------------------

  üì∫ Season 1 Episode 1
  ==================================================

  Choose file to KEEP (1-2), 's' to skip, or 'q' to quit: 1
  üóëÔ∏è  Delete: /media/16TB-HM/TV/Breaking Bad/Season 1/breaking.bad.s01e01.mp4? (y/N): y
  ‚úÖ Deleted: /media/16TB-HM/TV/Breaking Bad/Season 1/breaking.bad.s01e01.mp4
```

## Tips

1. **Review the series overview first** to understand the distribution
2. **Pay attention to quality warnings** - sometimes higher quality is worth keeping
3. **Use 's' to skip** if you're unsure about a particular duplicate
4. **Use 'q' to quit** and resume later - the scanner will find the same duplicates again
5. **Check file sizes** to understand quality differences

## Integration with Scanner

The duplicate manager is designed to work seamlessly with the media duplicate scanner:

1. **Run the scanner**: `python media_duplicate_scanner.py --movie-roots ... --tv-roots ...`
2. **Process duplicates**: `python duplicate_manager.py duplicate_report_*.json`
3. **Repeat as needed**: Run the scanner again to find any remaining duplicates

The manager handles cases where files have been deleted since the report was generated, so you can safely run it multiple times on the same report during development and testing.
